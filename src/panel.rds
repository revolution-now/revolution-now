# ===============================================================
# panel.rds
#
# Project: Revolution Now
#
# Created by David P. Sicilia on 2025-11-15.
#
# Description: Rds definitions for the panel module.
#
# ===============================================================
# Revolution Now
include "spread-render.hpp"
include "unit-flag.hpp"
include "render.hpp"

# ss
include "ss/colony-id.hpp"
include "ss/map-square.rds.hpp"
include "ss/nation.hpp"
include "ss/unit-id.hpp"
include "ss/commodity.rds.hpp"

# gfx
include "gfx/cartesian.hpp"

# base
include "base/maybe.hpp"

# C++ standard library
include "<string>"
include "<vector>"

namespace "rn"

# ===============================================================
# Entities on Panel.
# ===============================================================
sumtype.PanelCity {
  visible_colony {
    colony_id 'ColonyId',
  },
  # This one is either for a colony or dwelling. The caller needs
  # to use the viz to get it.
  foreign_colony {},
  dwelling {},
}

struct.PanelActiveUnit {
  unit_id 'UnitId',
  orders_name 'std::string',
}

struct.PanelUnit {
  generic_unit_id 'GenericUnitId',
  orders_name 'base::maybe<std::string>',
}

struct.PanelEntities {
  tile 'base::maybe<gfx::point>',

  player_turn 'base::maybe<e_player>',

  # The active unit is always a friendly unit.
  active_unit 'base::maybe<PanelActiveUnit>',

  # Colony or dwelling.
  city 'base::maybe<PanelCity>',

  # This does not include the active unit, if there is one. When
  # not in cheat mode this will never contain multiple foreign
  # units; it only contains the one visible on top. NOTE: these
  # will be sorted by the logic in the unit-stack module which
  # handles selecting the order of display when there are mul-
  # tiple units on a tile. We have to do it this way so that it
  # is consistent with what the player sees, especially in the
  # case where there are foreign units on a tile and we only want
  # the player to see the "top" one. NOTE: this ordering is not
  # the same as the unit ordering that controls ordering at the
  # colony gate or at the harbor.
  unit_stack 'std::vector<PanelUnit>',

  # This will always be true if there are multiple units on the
  # tile, even they are not all provided in the vector. This is
  # so that we can render a double flag so that it is consistent
  # with what the player would see on the map.
  has_multiple_units 'bool',

  square 'base::maybe<MapSquare>',
}

# ===============================================================
# Panel Layout.
# ===============================================================
struct.PanelCommodity {
  type 'e_commodity',
  greyed 'bool',
}

sumtype.PanelEntity {
  text {
    value 'std::string',
  },
  text_highlight {
    value 'std::string',
  },
  commodity_spread {
    # Commodity and grey status.
    comms 'std::vector<PanelCommodity>',
  },
  euro_unit {
    unit_id 'UnitId',
    flag_stacked 'bool',
  },
  brave {
    native_unit_id 'NativeUnitId',
    flag_stacked 'bool',
  },
  icon_colony {
    tile 'gfx::point',
  },
  icon_dwelling {
    tile 'gfx::point',
  },
}

struct.PanelRow {
  # Each column can have a number of rows within itself.
  columns 'std::vector<std::vector<PanelEntity>>',
}

struct.PanelLayout {
  rows 'std::vector<PanelRow>',
}

# ===============================================================
# Layout Render Plan.
# ===============================================================
struct.PanelTextRenderPlan {
  text 'std::string',
  color 'gfx::pixel',
}

struct.PanelUnitRenderPlan {
  unit_id 'UnitId',
  flag_info 'UnitFlagRenderInfo',
}

struct.PanelNativeUnitRenderPlan {
  native_unit_id 'NativeUnitId',
  flag_info 'UnitFlagRenderInfo',
}

struct.PanelColonyPlan {
  tile 'gfx::point',
  options 'ColonyRenderOptions',
}

struct.PanelRenderPlan {
  area 'gfx::rect',

  texts 'std::vector<std::pair<PanelTextRenderPlan, gfx::point>>',
  spreads 'std::vector<std::pair<TileSpreadRenderPlan, gfx::point>>',
  euro_units 'std::vector<std::pair<PanelUnitRenderPlan, gfx::point>>',
  braves 'std::vector<std::pair<PanelNativeUnitRenderPlan, gfx::point>>',
  colonies 'std::vector<std::pair<PanelColonyPlan, gfx::point>>',
  dwellings 'std::vector<std::pair<gfx::point, gfx::point>>',
}
