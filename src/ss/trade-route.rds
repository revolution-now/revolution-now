# ===============================================================
# trade-route.rds
#
# Project: Revolution Now
#
# Created by David P. Sicilia on 2025-10-25.
#
# Description: Rds definitions for the ss/trade-route module.
#
# ===============================================================
# ss
include "commodity.rds.hpp"
include "trade-route-id.hpp"
include "colony-id.hpp"
include "nation.rds.hpp"

# C++ standard library
include "<map>"
include "<string>"
include "<vector>"

namespace "rn"

enum.e_trade_route_type {
  land,
  sea,
}

sumtype.TradeRouteTarget {
  # Having the harbor first means that a default-constructed
  # target is valid. If the colony were first then the colony_id
  # would be zero and that would always be invalid.
  harbor {},
  colony {
    colony_id 'ColonyId',
  },

  _features { equality, validation }
}

struct.TradeRouteStop {
  target 'TradeRouteTarget',

  # NOTE: in the OG there is a maximum of six here. We don't need
  # to impose that, but we might for compatibility.
  loads 'std::vector<e_commodity>',

  # NOTE: in the OG there is a maximum of six here. We don't need
  # to impose that, but we might for compatibility.
  unloads 'std::vector<e_commodity>',
}

struct.TradeRoute {
  # Must be >= 1.
  id 'TradeRouteId',

  # NOTE: in the OG this is a max of 32 chars.
  name 'std::string',

  # Player that created the trade route. The OG does not have
  # this, so when we convert to OG SAV format we will only save
  # those from the designated human player (in the NG we can have
  # multiple human players).
  player 'e_player',

  type 'e_trade_route_type',

  # In the OG this has a maximum of four stops, and so in this
  # game we limit it to four as well. This is mainly because the
  # editing UI only supports four stops, but also because we
  # wouldn't be able to interconvert to the OG SAV files. This
  # shouldn't really be an issue, even if the player has no in-
  # tention of converting to OG SAV because they can just create
  # more trade routes if they need to, since in the NG we don't
  # cap them at 12 unlike the OG.
  stops 'std::vector<TradeRouteStop>',

  _features { equality, validation }
}

struct.TradeRouteState {
  # Trade route IDs must be >= 1, so we store this as "previous"
  # so that the default value of zero is a valid value: it means
  # that no trade routes have yet been created. If we were to
  # store "next" then it would have to be at least one.
  #
  # Note that this also effectively gives the total number of
  # trade routes that have ever been created since the start of
  # the game.
  last_trade_route_id 'TradeRouteId',

  # NOTE: in the OG there are a maximum of 12 trade routes.
  routes 'std::map<TradeRouteId, TradeRoute>',

  _features { equality, validation }
}
