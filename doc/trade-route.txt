TODO:

  * Show the trade route of the active unit in the panel.

  * Need to limit the number of wagon trains per colony as in the
    OG, or perhaps find another way to limit their number, e.g.
    by increasing the cost exponentially for each one built. Or,
    if the wagon train remains stationary for more than x number
    of turns, any goods in it will spoil (!!). With a bit of in-
    telligence in this algorithm, it could work to allow an arbi-
    trary number of wagon trains without the player being able to
    exploit them for additional storage. This may not work be-
    cause the player could just put the wagon trains on a trade
    route between two colonies, just moving back and forth. It is
    important to solve this because simply limiting the number of
    wagon trains to the number of colonies can be cheated by cre-
    ating a large number of temporary population-1 colonies and
    then building the wagon trains, then abandoning the colonies.

  * When a ship trades in the harbor a message will be shown over
    the land view without showing the harbor.

  * There is a strategy (described in the SG) whereby one can
    chain wagon train routes to move items within one turn a dis-
    tance much further than one wagon train can move. Doing this
    efficiently requires the player being able to set up wagon
    trains that move in a predictable order so that one can pick
    up where the prior one left off. Make sure this works. EDIT:
    not sure how this is possible given that the wagon train does
    not unload in the same turn when it arrives at a colony...
    need to take another look at that; if it came from the SG
    then it could be something outdated.

  * Go through the trade route files and put more stuff in the
    configs.

  * Do one last check of all the CHECKs in the trade route mod-
    ules to make sure there is nothing risky.

Maybe in the future:

  * Allow editing the trade route of a unit by right clicking on
    it. This might be tricky since it might require reworking
    that way that menus work, since currently they can't really
    carry context information that can be delivered to the place
    where the menu selection is handled and/or enabled/disabled.

  * In the OG, when a wagon train arrives at a colony or load-
    s/unloads stuff, a brief message appears in the top bar. Not
    sure yet if we want to replicate this. Might be awkward be-
    cause the loading/unloading is done at the start of its turn
    right before it launches off to its next target, so not sure
    how that would make sense visually to the player.

  * If a wagon train aborts its trade route because there is a
    distant brave blocking the path, there should probably be a
    message notifying the user. Or even better, if the brave is
    far enough away, the wagon train should somehow keep going
    anyway since the brave will probably have moved by the time
    it gets to that area.

Done:

  * Add the trade route data structure to ss.

  * Add T to unit flag rendering.

  * In the sav files a unit on a trade route keeps track of which
    trade route it is on and which stop it is headed to next in
    the `auxiliary_data` field.

  * Add trade_route to unit orders.

  * Enable Trade Route menu item in orders menu.

  * Add 't' key to land view input.

  * The way that the OG loads cargo is according to market value.
    It looks at all the goods to load and it iterates through
    them and finds the most valuable one, multiplying market sell
    price*quantity (quantity can be > 100, which we allow so that
    we also weight the selection toward commodities that we have
    more of, all else being equal, so as to balance them out),
    then it loads 100 of the one that had the max value (or less
    than 100 if there is less). If there are multiple goods tied
    for the max value then it will take the one furthest to the
    right. Then it repeats this until it cannot load any further,
    which in this case is equivalent to all slots being filled or
    partially filled.

  * The way that ship loading in the harbor works is that it just
    iterates over the commodities in order and attempts to buy
    100 (or as much as it can fit). If it can then it will, oth-
    erwise it will move onto the next one.

  * Need to handle the case (in the trade route edit UI and else-
    where) where a colony does no longer exist. Solution: trade
    route state will be sanitized before any operation that re-
    quires it, and if e.g. the player tries to edit a trade route
    and one of them is left with no colonies, a message is dis-
    played and the trade route is removed.

  * Wagon trains need to end their turn when entering a colony.

  * Note that the trade route edit screen allows editing the
    name.

  * In the editor screen, for land routes, the first stop defines
    the continent, then it will only allow selecting other
    colonies on that same continent, and we should probably
    replicate this. That said, in the menus that appear when cre-
    ating a new trade route, it will allow selecting two colonies
    on different continents for a land route, which is probably a
    bug.

  * The editor screen will avoid inland colonies for sea routes
    and will avoid cross continent colonies for land routes.

  * The OG does not allow a trade route with zero stops, so we
    probably shouldn't allow that as well, since it would have no
    purpose and would make things more complicated when con-
    verting sav files.

  * When the wagon train lands in a colony, it does not do its
    loading/unloading until the start of the next turn.

  * When a unit starts a trade route, the gui allows selecting
    the starting location.

  * When creating a sea trade route, the harbor is among the
    available stops. However, second-stop menu does not include
    it, but probably should. In the OG it can be added in the
    trade route editing screen.

  * Need to support the fact that a trade route can be edited
    while there are units carrying it out.

  * Need to make sure that transacting in the harbor while on a
    trade route respects boycotts.

  * Need a list of default name suffixes for trade routes.

  * Need to handle the case when there is only one colony in the
    route. Currently we do handle it in the sense that we don't
    get into an infinite loop and we clear the orders of the
    unit. However, the OG shows a message. We should probably do
    this also, because there is the possibility that a trade
    route could be left with only one stop if e.g. a colony on
    the route gets captured or destroyed, and we don't want the
    player to be confused about why the trade route stopped.

  * In the OG, wagon trains and ships end their turn when en-
    tering a colony, whether on a trade route or not. Given how
    the mechanics of trade routes work where the unit arrives in
    a colony and then waits a turn before they unload and pro-
    ceed, it is necessary that any unit on a trade route end
    their turn when they hit a colony. This is ensured automati-
    cally, regardless of unit config. But it would be good to
    have a flag where we can turn this off so that those units
    don't have to end their turn in a colony when they are not on
    a trade route. This makes sense because one option that
    people may not like is that wagon trains must always end
    their turn in a colony even if not on a trade route. We
    should probably make it a game config option that this can be
    turned off.

  * Need to allow for the player editing the map, which could put
    colonies within a given trade route on different continents.

  * Although the OG allows a trade route with one stop, it dis-
    plays a message each turn when a unit is on that trade route
    (and at the stop), so in effect it doesn't like them.

  * If a colony that is on a trade route is captured then we
    should handle that properly.

  * When a wagon train cannot find a path to its next stop it
    will clear its orders. Maybe a message should be displayed in
    this case. In practice this happens when braves get in the
    way.

  * The auto load algo used for trade routes seems to behave
    slightly differently from the "auto load" feature in the
    colony that happens when you press 'L', though they seem sim-
    ilar. Need to investigate how the latter works. Indications
    are that it loads the commodity with the largest market value
    but where the quantity is capped at 100. We may want to just
    use the same algo as for wagon train loading.

  * Add the bridge for trade routes to sav/bridge.

  * Units in the harbor on trade routes should have that status
    shown, and there should be a menu option when clicking on it
    to clear the trade route status.

  * Need to ensure that if a ship is in the harbor carrying out a
    trade route and either the trade route gets deleted, or its
    next stop gets deleted (possibly leaving only the harbor in
    the list) that it does the right thing.

  * When a ship arrives in the harbor it will transact immedi-
    ately. But then the ship waits until the next turn to sail
    back. Not sure we're going to replicate this, since it
    doesn't seem to matter much, and is inconsistent with wagon
    train behavior.

  * Make sure there aren't duplicate trade route names both when
    creating and in the validation.

  * When the player manually loads into a wagon train in the
    colony view, its orders clear.

  * Make sure that things are ok if a unit is on a trade route
    and then the control of the player is changed to AI.

  * In the OG there is a bug where trade routes can't load or un-
    load stuff in colonies if they are boycotted. Add a test to
    make sure that doesn't happen.
