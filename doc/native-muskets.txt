# vim: syntax=yaml
Native Muskets
==============

Data/Definitions
----------------

  muskets: per tribe.

    * This represents the stockpile held by the tribe.

Acquisition
-----------

  * When a brave attacks and wins a battle against a unit that
    loses muskets in the process then it will always acquire
    those muskets, but the tribes stockpile does not increase.

  * When a brave with muskets wins against a unit that loses
    their muskets as a result, the tribe's stockpile does not in-
    crease.

  * When muskets are sold to a dwelling they go into the tribe's
    "stock", which does not appear to have a limit. Note that the
    stockpile decreases at a rate of 1 per turn, though that is
    probably not relevant here (and this behavior is probably
    similar to trading other commodities).

    If, in a given sale, they purchase an amount >= 25, then, in
    addition to those muskets going into their stockpile as usual,
    the `muskets` military stockpile goes up by an amount:

        muskets += min( floor( amount_purchased / 25 ), 2 )

    So in other words their stock goes up by the amount purchased
    and also their military `muskets` stockpile goes up by the
    number of even multiples of 25 that they purchased (with a
    max of 2). So if they purchased 49 then it goes up by 1,
    while if they purchase 50 it goes up by two. If they purchase
    75 it still only goes up by two.

    Counterintuitively, muskets in a tribe's stockpile cannot/do
    not transfer directly into their military muskets stockpile.
    It seems that the only way that selling muskets to a tribe
    can increase their military stockpile (`muskets`) is if they
    are sold, in a single sale, more than 25 muskets.

  * When a wagon train containing muskets is attacked, the braves
    do not ever seem to steal the muskets, let alone add them to
    their stockpile.

  * When a colony is raided an muskets are stolen, the military
    muskets stockpile increases by this formula:

        muskets += clamp( floor( amount_stolen / 25 ), 1, 2 )

    where the clamp is inclusive and this has been observed to
    apply to a stolen amount of as little as 5 (in which case
    muskets += 1) and to an amount as large as 82 (in which case
    muskets += 2). Note that the value of 82 was stolen when the
    colony had a warehouse expansion and a quantity of 300 mus-
    kets, since otherwise they wouldn't have stolen that much.

  * When muskets are demanded via reparations and the brave
    asking does not have muskets then it will immediately acquire
    muskets and the tribe's stockpile will remain the same. If
    the brave asking already has muskets then the muskets will be
    added to the tribe's stockpile. The amount demanded and/or
    received does not seem to affect the amount that the tribe
    actually takes; the tribe always seems to take one unit, i.e.
    arming one brave or increasing the stockpile by 1.

  * There does not seem to be any inter-tribe trading of muskets.
    The SG mentions it though, so it may be a bug that it is
    omitted, or perhaps we just don't know the mechanism. It does
    not seem to happen automatically when braves of two tribes
    come into contact as is done with horses.

  * When trading muskets with a tribe, the same rules apply about
    not purchasing the same thing twice in a row. So even if the
    tribe can clearly use muskets, a dwelling will not buy them
    twice in a row.

Musket Distribution
-------------------

  * When a brave is given muskets randomly whether to decrease
    the muskets number, and the probability of decrease depends
    on difficulty level:

      Discoverer:   100%
      Explorer:      50%
      Conquistador:  33%
      Governor:      25%
      Viceroy:       20%

    The formula is:

      P = 1/(1+D)

    where D is 0 for Discoverer, 1 for Explorer, etc.

  * When a brave that already exists is given muskets, it appears
    to consume its turn.

  * When a brave that already exists is over a dwelling and can
    be given muskets, there is a small probability that it will
    not be given them. The probability that it will be given mus-
    kets is:

            semi-nomadic  agrarian  advanced  civilized
       Prob          79%       88%       92%        94%

    Not quite sure if these numbers are reliable and/or what they
    mean. They may be capturing some other variables that dif-
    fered between the tribes that wasn't apparent. Also may have
    something to do with how braves move. More investigation is
    needed.

Musket Replication
------------------

  * There isn't musket replication properly as happens with
    horses, however the randomness with which the `muskets` field
    is decreased can have the effect (randomly) of creating more
    muskets than were initially given to the natives. On discov-
    erer, since the decrease probability is 100%, muskets are
    fully conserved there.

Musket Loss
-----------

  * A tribe that acquires muskets can eventually lose them. This
    can happen either by destroying (all) dwellings or braves
    with muskets.

  * When a brave with muskets gets destroyed there is a proba-
    bility that the tribe will retain the muskets. Here "retain"
    means ++muskets. In fact, this mechanism can make the muskets
    drift to a value higher than that tribe has ever been given.
    The probability is 1/2, and this is independent of tribe or
    difficulty level.

  * When a tribe has muskets and one of its dwellings gets de-
    stroyed the muskets do not change; they get sent to the re-
    maining dwellings. Is this a bug? Seems inconsistent with
    horses.

  * Dwellings have not been observed to sell muskets, so not sure
    what would happen if they did.

Inter-tribe Trade
-----------------

Indian Advisor Report
---------------------

  * The muskets readout does not appear to be stored anywhere;
    instead it is computed as follows:

       Muskets = 50*muskets + 50*armed_braves_count
                            + 50*mounted_warriors_count

    That said, we may do this readout a bit differently. This is
    because the value of `muskets` can arm an arbitrary number of
    braves due to the randomness with which `muskets` is de-
    creased. Therefore, if we use the above formula, then the
    total muskets that a tribe has can appear to increase, which
    isn't sensical to the player (though note that on Discoverer,
    `muskets` is always decreased, and so this readout is accu-
    rate/conserved on that difficulty level). Instead maybe we'll
    separate it into two fields:

       Musket Reserves = 50*muskets
       Armed Units     = 50*armed_braves_count
                       + 50*mounted_warriors_count

    Then on higher difficulty levels, one could say that the na-
    tives use the reserves more efficiently.

Difficulty Level
----------------

  * Probability of decreasing the stockpile of `muskets` when
    giving muskets to a brave depends on difficulty level.

Bugs
----

  * Seems that when a dwelling is destroyed the tribe's musket
    count does not decrease, unlike with horses. Not sure if this
    is a bug or not. But we will reproduce it.

  * There does not seem to be any inter-tribe trade of muskets.
    Or if there is, perhaps we just don't know the mechanism.
